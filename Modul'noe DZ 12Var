// ============================================================================
// –ú–û–î–ï–õ–ò–†–û–í–ê–ù–ò–ï –¢–†–ê–ï–ö–¢–û–†–ò–ò –ü–û–õ–ï–¢–ê –°–ê–ú–û–õ–ï–¢–ê –¢–£-134
// ============================================================================
#include <vector>
#include <cmath>
#include <fstream>
#include <iomanip>
#include <string>
#include <algorithm>
#include <memory>
#include <cstdio>
#include <stdio.h>
#include <stdlib.h>
#include <locale.h>
#ifndef M_PI
#define M_PI 3.14159265358979323846
#endif

// –ú–∞—Å—Å–æ–≤—ã–µ –∏ –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
const double BASELINE_MASS     = 43000.0;   // –°—Ç–∞—Ä—Ç–æ–≤–∞—è –º–∞—Å—Å–∞, –∫–≥
const double WING_AREA         = 127.3;     // –ü–ª–æ—â–∞–¥—å –∫—Ä—ã–ª–∞, –º¬≤

// –î–≤–∏–≥–∞—Ç–µ–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
const double ENGINE_THRUST     = 2 * 6800.0; // –°—É–º–º–∞—Ä–Ω–∞—è —Ç—è–≥–∞, –ù
const double THROTTLE_POSITION = 1.1;       // –ü–æ–ª–æ–∂–µ–Ω–∏–µ –†–£–î

// –ó–∞–¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–ª–µ—Ç–∞
const double START_ALTITUDE    = 500.0;     // –ù–∞—á–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞, –º
const double TARGET_ALTITUDE   = 7000.0;    // –ö—Ä–µ–π—Å–µ—Ä—Å–∫–∞—è –≤—ã—Å–æ—Ç–∞, –º

// –°–∫–æ—Ä–æ—Å—Ç–Ω—ã–µ —Ä–µ–∂–∏–º—ã (–∫–º/—á -> –º/—Å)
const double START_SPEED_KPH   = 330.0;
const double TARGET_SPEED_KPH  = 840.0;
const double START_SPEED_MS    = START_SPEED_KPH / 3.6;
const double TARGET_SPEED_MS   = TARGET_SPEED_KPH / 3.6;

// –§–∏–∑–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
const double GRAVITY           = 9.81;      // –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø–∞–¥–µ–Ω–∏—è, –º/—Å¬≤
const double AIR_GAS_CONSTANT  = 287.05;    // –£–¥–µ–ª—å–Ω–∞—è –≥–∞–∑–æ–≤–∞—è –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è, –î–∂/(–∫–≥¬∑–ö)

class CSVWriter {
private:
    std::ofstream file;

public:

    CSVWriter(const std::string& filename) {
        file.open(filename);
        if (!file.is_open()) {
            throw std::runtime_error("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–∞: " + filename);
        }
    }

\
    ~CSVWriter() {
        if (file.is_open()) file.close();
    }

     void writeHeader(const std::vector<std::string>& column_names) {
        for (size_t i = 0; i < column_names.size(); ++i) {
            file << column_names[i];
            if (i < column_names.size() - 1) file << ',';
        }
        file << std::endl;
    }


    void writeDataRow(const std::vector<double>& values) {
        for (size_t i = 0; i < values.size(); ++i) {
            file << std::fixed << std::setprecision(6) << values[i];
            if (i < values.size() - 1) file << ',';
        }
        file << std::endl;
    }
};

class AtmosphericModel {
private:

    std::vector<double> altitude_data;      // –º
    std::vector<double> temperature_data;   // –ö
    std::vector<double> pressure_data;      // –ü–∞
    std::vector<double> density_data;       // –∫–≥/–º¬≥
    std::vector<double> sound_speed_data;   // –º/—Å

public:
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—á–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
    AtmosphericModel() {
        initializeAtmosphereTable();
    }

private:
    void initializeAtmosphereTable() {
        // –í—ã—Å–æ—Ç–Ω—ã–µ –æ—Ç–º–µ—Ç–∫–∏
        altitude_data = { 0, 500, 1000, 1500, 2000, 2500, 3000,
                         3500, 4000, 4500, 5000, 5500, 6000 };

        // –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–æ –≤—ã—Å–æ—Ç–µ
        temperature_data = { 288.15, 284.90, 281.65, 278.40, 275.15,
                            271.90, 268.65, 265.40, 262.15, 258.90,
                            255.65, 252.40, 249.15 };

        // –ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ
        pressure_data = { 101325.0, 95463.0, 89976.0, 84808.0, 79916.0,
                         75260.0, 70801.0, 66604.0, 62634.0, 58860.0,
                         55252.0, 51881.0, 48720.0 };

        // –ü–ª–æ—Ç–Ω–æ—Å—Ç—å –≤–æ–∑–¥—É—Ö–∞
        density_data = { 1.2250, 1.1673, 1.1117, 1.0581, 1.0066,
                        0.9570, 0.9093, 0.8635, 0.8196, 0.7775,
                        0.7369, 0.6979, 0.6605 };

        // –°–∫–æ—Ä–æ—Å—Ç—å –∑–≤—É–∫–∞
        sound_speed_data = { 340.29, 338.37, 336.44, 334.50, 332.54,
                            330.57, 328.58, 326.58, 324.56, 322.52,
                            320.47, 318.40, 316.31 };
    }

    double interpolateLinear(double x,
                            const std::vector<double>& x_points,
                            const std::vector<double>& y_points) const {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
        if (x <= x_points.front()) return y_points.front();
        if (x >= x_points.back()) return y_points.back();

        for (size_t i = 0; i < x_points.size() - 1; ++i) {
            if (x >= x_points[i] && x <= x_points[i + 1]) {
                double t = (x - x_points[i]) / (x_points[i + 1] - x_points[i]);
                return y_points[i] + t * (y_points[i + 1] - y_points[i]);
            }
        }
        return y_points.back();
    }

public:
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã –Ω–∞ –∑–∞–¥–∞–Ω–Ω–æ–π –≤—ã—Å–æ—Ç–µ
    double getTemperature(double altitude) const {
        return interpolateLinear(altitude, altitude_data, temperature_data);
    }

    double getPressure(double altitude) const {
        return interpolateLinear(altitude, altitude_data, pressure_data);
    }

    double getDensity(double altitude) const {
        return interpolateLinear(altitude, altitude_data, density_data);
    }

    double getSoundSpeed(double altitude) const {
        return interpolateLinear(altitude, altitude_data, sound_speed_data);
    }

    // –†–∞—Å—á–µ—Ç —á–∏—Å–ª–∞ –ú–∞—Ö–∞
    double calculateMachNumber(double velocity, double altitude) const {
        return velocity / getSoundSpeed(altitude);
    }
};

struct AircraftState {
    // –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    double time_seconds;        // –í—Ä–µ–º—è —Å –Ω–∞—á–∞–ª–∞ –ø–æ–ª–µ—Ç–∞, —Å

    // –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
    double position_x;          // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞, –º
    double altitude;            // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ (–≤—ã—Å–æ—Ç–∞), –º

    // –ö–∏–Ω–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    double velocity_total;      // –ü–æ–ª–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å, –º/—Å
    double velocity_horizontal; // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∞—è, –º/—Å
    double velocity_vertical;   // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∞—è, –º/—Å

    // –£–≥–ª–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    double flight_path_angle;   // –£–≥–æ–ª —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏, —Ä–∞–¥
    double angle_of_attack;     // –£–≥–æ–ª –∞—Ç–∞–∫–∏, —Ä–∞–¥

    // –ú–∞—Å—Å–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    double fuel_consumed;       // –ò–∑—Ä–∞—Å—Ö–æ–¥–æ–≤–∞–Ω–Ω–æ–µ —Ç–æ–ø–ª–∏–≤–æ, –∫–≥
    double current_mass;        // –¢–µ–∫—É—â–∞—è –º–∞—Å—Å–∞, –∫–≥

    // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    double acceleration;        // –¢–∞–Ω–≥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ, –º/—Å¬≤
    double mach_number;         // –ß–∏—Å–ª–æ –ú–∞—Ö–∞

    // –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    AircraftState(double t = 0, double x = 0, double h = 0,
                 double V = 0, double Vx = 0, double Vy = 0,
                 double theta = 0, double alpha = 0, double fuel = 0,
                 double mass = BASELINE_MASS, double acc = 0,
                 double mach = 0)
        : time_seconds(t), position_x(x), altitude(h),
          velocity_total(V), velocity_horizontal(Vx), velocity_vertical(Vy),
          flight_path_angle(theta), angle_of_attack(alpha),
          fuel_consumed(fuel), current_mass(mass),
          acceleration(acc), mach_number(mach) {}

    // –í—ã–≤–æ–¥ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª—å
    void printStatus() const {
        std::cout << std::fixed << std::setprecision(1);
        std::cout << "–í—Ä–µ–º—è: " << time_seconds << " —Å | ";
        std::cout << "–í—ã—Å–æ—Ç–∞: " << altitude << " –º | ";
        std::cout << "–°–∫–æ—Ä–æ—Å—Ç—å: " << velocity_total * 3.6 << " –∫–º/—á | ";
        std::cout << "–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: " << velocity_vertical << " –º/—Å | ";
        std::cout << "–£–≥–æ–ª —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏: " << flight_path_angle * 180 / M_PI << "¬∞ | ";
        std::cout << "–ú–∞—Å—Å–∞: " << current_mass << " –∫–≥\n";
    }
};

class FlightTrajectory {
private:
    std::vector<AircraftState> trajectory_points;

public:
    FlightTrajectory() = default;

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ç–æ—á–∫–∏ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏
    void addStatePoint(const AircraftState& state) {
        trajectory_points.push_back(state);
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç–æ—á–µ–∫ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏
    const std::vector<AircraftState>& getAllStates() const {
        return trajectory_points;
    }

    // –û–±—â–µ–µ –≤—Ä–µ–º—è –ø–æ–ª–µ—Ç–∞
    double getTotalFlightTime() const {
        return trajectory_points.empty() ? 0.0 : trajectory_points.back().time_seconds;
    }

    // –û–±—â–∏–π —Ä–∞—Å—Ö–æ–¥ —Ç–æ–ø–ª–∏–≤–∞
    double getTotalFuelConsumption() const {
        return trajectory_points.empty() ? 0.0 : trajectory_points.back().fuel_consumed;
    }

    // –≠–∫—Å–ø–æ—Ä—Ç —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –≤ CSV-—Ñ–∞–π–ª
    void exportToCSV(const std::string& filename) {
        CSVWriter csv_writer(filename);

        // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å—Ç–æ–ª–±—Ü–æ–≤
        csv_writer.writeHeader({
            "time_s", "altitude_m", "velocity_ms", "velocity_kmh",
            "vertical_velocity_ms", "theta_deg", "alpha_deg",
            "fuel_kg", "mass_kg", "acceleration_ms2", "mach_number"
        });

        // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö
        for (const auto& state : trajectory_points) {
            csv_writer.writeDataRow({
                state.time_seconds,
                state.altitude,
                state.velocity_total,
                state.velocity_total * 3.6,
                state.velocity_vertical,
                state.flight_path_angle * 180 / M_PI,
                state.angle_of_attack * 180 / M_PI,
                state.fuel_consumed,
                state.current_mass,
                state.acceleration,
                state.mach_number
            });
        }

        std::cout << "–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ —Ñ–∞–π–ª: " << filename << std::endl;
    }

    // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ —Å –ø–æ–º–æ—â—å—é Gnuplot
    void visualize() const {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Gnuplot
        FILE* gnuplot = _popen("gnuplot -persist", "w");
        if (!gnuplot) {
            std::cerr << "‚úó –û—à–∏–±–∫–∞: Gnuplot –Ω–µ –Ω–∞–π–¥–µ–Ω!" << std::endl;
            std::cerr << "  –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Gnuplot –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ PATH" << std::endl;
            return;
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤
        fprintf(gnuplot, "set terminal wxt size 1200,800 enhanced font 'Arial,12'\n");
        fprintf(gnuplot, "set multiplot layout 2,2 title '–î–∏–Ω–∞–º–∏–∫–∞ –ø–æ–ª–µ—Ç–∞ –¢–£-134'\n");
        fprintf(gnuplot, "set grid\n");

        // –ì—Ä–∞—Ñ–∏–∫ 1: –í—ã—Å–æ—Ç–∞ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏
        fprintf(gnuplot, "set title '–í—ã—Å–æ—Ç–∞ –ø–æ–ª–µ—Ç–∞'\n");
        fprintf(gnuplot, "set xlabel '–í—Ä–µ–º—è, —Å'\n");
        fprintf(gnuplot, "set ylabel '–í—ã—Å–æ—Ç–∞, –º'\n");
        fprintf(gnuplot, "plot '-' with lines lw 2 lc rgb 'blue' title '–í—ã—Å–æ—Ç–∞'\n");
        for (const auto& state : trajectory_points) {
            fprintf(gnuplot, "%f %f\n", state.time_seconds, state.altitude);
        }
        fprintf(gnuplot, "e\n");

        // –ì—Ä–∞—Ñ–∏–∫ 2: –°–∫–æ—Ä–æ—Å—Ç—å –æ—Ç –≤—Ä–µ–º–µ–Ω–∏
        fprintf(gnuplot, "set title '–°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–ª–µ—Ç–∞'\n");
        fprintf(gnuplot, "set xlabel '–í—Ä–µ–º—è, —Å'\n");
        fprintf(gnuplot, "set ylabel '–°–∫–æ—Ä–æ—Å—Ç—å, –∫–º/—á'\n");
        fprintf(gnuplot, "plot '-' with lines lw 2 lc rgb 'red' title '–°–∫–æ—Ä–æ—Å—Ç—å'\n");
        for (const auto& state : trajectory_points) {
            fprintf(gnuplot, "%f %f\n", state.time_seconds, state.velocity_total * 3.6);
        }
        fprintf(gnuplot, "e\n");

        // –ì—Ä–∞—Ñ–∏–∫ 3: –ú–∞—Å—Å–∞ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏
        fprintf(gnuplot, "set title '–ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–∞—Å—Å—ã'\n");
        fprintf(gnuplot, "set xlabel '–í—Ä–µ–º—è, —Å'\n");
        fprintf(gnuplot, "set ylabel '–ú–∞—Å—Å–∞, –∫–≥'\n");
        fprintf(gnuplot, "plot '-' with lines lw 2 lc rgb 'green' title '–ú–∞—Å—Å–∞'\n");
        for (const auto& state : trajectory_points) {
            fprintf(gnuplot, "%f %f\n", state.time_seconds, state.current_mass);
        }
        fprintf(gnuplot, "e\n");

        fprintf(gnuplot, "unset multiplot\n");
        fflush(gnuplot);

        std::cout << "\nüìä –ì—Ä–∞—Ñ–∏–∫–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω—ã –≤ Gnuplot" << std::endl;
        std::cout << "   –ó–∞–∫—Ä–æ–π—Ç–µ –æ–∫–Ω–æ Gnuplot –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è..." << std::endl;
        std::cin.get();

        _pclose(gnuplot);
    }
};

// –ö–õ–ê–°–° –ú–û–î–ï–õ–ò

class Aircraft {
private:
    AtmosphericModel atmosphere;    // –ú–æ–¥–µ–ª—å –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã
    double wing_area;              // –ü–ª–æ—â–∞–¥—å –∫—Ä—ã–ª–∞
    double initial_mass;           // –ù–∞—á–∞–ª—å–Ω–∞—è –º–∞—Å—Å–∞

public:
    double current_mass;           // –¢–µ–∫—É—â–∞—è –º–∞—Å—Å–∞
    double engine_thrust;          // –¢–µ–∫—É—â–∞—è —Ç—è–≥–∞
    double fuel_consumption_rate;  // –†–∞—Å—Ö–æ–¥ —Ç–æ–ø–ª–∏–≤–∞
    double zero_lift_drag;         // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –Ω—É–ª–µ–≤–æ–π –ø–æ–¥—ä–µ–º–Ω–æ–π —Å–∏–ª–µ
    double induced_drag_coeff;     // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∏–Ω–¥—É–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
    double max_lift_coefficient;   // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–æ–¥—ä–µ–º–Ω–æ–π —Å–∏–ª—ã

    Aircraft(double mass = BASELINE_MASS, double area = WING_AREA)
        : wing_area(area), initial_mass(mass), current_mass(mass) {

        engine_thrust = ENGINE_THRUST * THROTTLE_POSITION;
        fuel_consumption_rate = 2.5;           // –∫–≥/—Å
        zero_lift_drag = 0.02;                 // Cx0
        induced_drag_coeff = 0.05;             // K
        max_lift_coefficient = 1.2;            // Cy_max
    }

    // –†–∞—Å—á–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –ø–æ–¥—ä–µ–º–Ω–æ–π —Å–∏–ª—ã
    double calculateLiftCoefficient(double angle_of_attack) const {
        const double LIFT_SLOPE = 5.0;  // –ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –ø–æ–¥—ä–µ–º–Ω–æ–π —Å–∏–ª—ã
        return std::min(LIFT_SLOPE * angle_of_attack, max_lift_coefficient);
    }

    // –†–∞—Å—á–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –ª–æ–±–æ–≤–æ–≥–æ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
    double calculateDragCoefficient(double lift_coefficient) const {
        // –ü–∞—Ä–∞–±–æ–ª–∏—á–µ—Å–∫–∞—è –ø–æ–ª—è—Ä–∞: Cx = Cx0 + K*Cy¬≤
        return zero_lift_drag + induced_drag_coeff * lift_coefficient * lift_coefficient;
    }

    // –†–∞—Å—á–µ—Ç –ø–æ–¥—ä–µ–º–Ω–æ–π —Å–∏–ª—ã
    double computeLiftForce(double velocity, double altitude, double aoa) const {
        double air_density = atmosphere.getDensity(altitude);
        double dynamic_pressure = 0.5 * air_density * velocity * velocity;
        double lift_coeff = calculateLiftCoefficient(aoa);
        return lift_coeff * wing_area * dynamic_pressure;
    }

    // –†–∞—Å—á–µ—Ç —Å–∏–ª—ã —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
    double computeDragForce(double velocity, double altitude, double aoa) const {
        double air_density = atmosphere.getDensity(altitude);
        double dynamic_pressure = 0.5 * air_density * velocity * velocity;
        double lift_coeff = calculateLiftCoefficient(aoa);
        double drag_coeff = calculateDragCoefficient(lift_coeff);
        return drag_coeff * wing_area * dynamic_pressure;
    }

    AircraftState predictNextState(const AircraftState& current_state,
                                  double time_step,
                                  double commanded_aoa) {
        AircraftState next_state = current_state;

        // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —É–≥–ª–∞ –∞—Ç–∞–∫–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        commanded_aoa = std::max(-0.1, std::min(0.2, commanded_aoa));

        // –†–∞—Å—á–µ—Ç –∞—ç—Ä–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Å–∏–ª
        double lift = computeLiftForce(current_state.velocity_total,
                                      current_state.altitude, commanded_aoa);
        double drag = computeDragForce(current_state.velocity_total,
                                      current_state.altitude, commanded_aoa);

        // –°–∏–ª—ã –ø–æ –æ—Å—è–º
        double force_horizontal = engine_thrust - drag -
                                  current_mass * GRAVITY * sin(current_state.flight_path_angle);
        double force_vertical = lift -
                               current_mass * GRAVITY * cos(current_state.flight_path_angle);

        // –£—Å–∫–æ—Ä–µ–Ω–∏—è
        double acceleration_horizontal = force_horizontal / current_mass;
        double acceleration_vertical = force_vertical / current_mass;

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
        next_state.velocity_total = current_state.velocity_total +
                                   acceleration_horizontal * time_step;
        next_state.velocity_total = std::max(100.0, next_state.velocity_total);

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–≥–ª–∞ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏
        if (next_state.velocity_total > 0) {
            next_state.flight_path_angle = atan2(acceleration_vertical,
                acceleration_horizontal + GRAVITY * sin(current_state.flight_path_angle));
        }

        // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —É–≥–ª–∞ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏
        next_state.flight_path_angle = std::max(-0.3, std::min(0.3, next_state.flight_path_angle));

        // –°–æ—Å—Ç–∞–≤–ª—è—é—â–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
        next_state.velocity_horizontal = next_state.velocity_total * cos(next_state.flight_path_angle);
        next_state.velocity_vertical = next_state.velocity_total * sin(next_state.flight_path_angle);

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
        next_state.position_x = current_state.position_x +
                               next_state.velocity_horizontal * time_step;
        next_state.altitude = current_state.altitude +
                             next_state.velocity_vertical * time_step;

        // –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π –≤—ã—Å–æ—Ç—ã
        if (next_state.altitude < 0) {
            next_state.altitude = 10.0;
            next_state.velocity_vertical = std::max(0.0, next_state.velocity_vertical);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞—ç—Ä–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        next_state.angle_of_attack = commanded_aoa;
        next_state.mach_number = atmosphere.calculateMachNumber(next_state.velocity_total,
                                                               next_state.altitude);
        next_state.acceleration = acceleration_horizontal;

        // –†–∞—Å—Ö–æ–¥ —Ç–æ–ø–ª–∏–≤–∞ –∏ –º–∞—Å—Å—ã
        double fuel_burned = fuel_consumption_rate * time_step;
        next_state.fuel_consumed = current_state.fuel_consumed + fuel_burned;
        next_state.current_mass = current_state.current_mass - fuel_burned;

        // –ö–æ—Ä—Ä–µ–∫—Ü–∏—è —Ç—è–≥–∏ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å)
        engine_thrust = ENGINE_THRUST * THROTTLE_POSITION *
                       (next_state.current_mass / initial_mass);

        next_state.time_seconds = current_state.time_seconds + time_step;

        return next_state;
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω–æ–π –º–∞—Å—Å—ã
    double getInitialMass() const {
        return initial_mass;
    }
};

// –ö–õ–ê–°–° –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò

class TrajectoryPlanner {
public:
    TrajectoryPlanner() = default;

    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏
    FlightTrajectory calculateFlightPath(Aircraft& aircraft, double max_flight_time = 600.0) {
        FlightTrajectory flight_path;
        const double TIME_INCREMENT = 1.0;  // –®–∞–≥ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∏—è, —Å

        // --------------------------------------------------------------------
        // –ù–ê–ß–ê–õ–¨–ù–´–ï –£–°–õ–û–í–ò–Ø
        // --------------------------------------------------------------------
        AircraftState initial_condition;
        initial_condition.time_seconds = 0;
        initial_condition.position_x = 0;
        initial_condition.altitude = START_ALTITUDE;
        initial_condition.velocity_total = START_SPEED_MS;
        initial_condition.velocity_horizontal = START_SPEED_MS;
        initial_condition.velocity_vertical = 5.0;      // –ù–∞—á–∞–ª—å–Ω—ã–π –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Ä–∞–∑–≥–æ–Ω
        initial_condition.flight_path_angle = 0.05;     // –ù–∞—á–∞–ª—å–Ω—ã–π —É–≥–æ–ª –ø–æ–¥—ä–µ–º–∞ (~3¬∞)
        initial_condition.angle_of_attack = 0.03;       // –ù–∞—á–∞–ª—å–Ω—ã–π —É–≥–æ–ª –∞—Ç–∞–∫–∏
        initial_condition.fuel_consumed = 0;
        initial_condition.current_mass = aircraft.getInitialMass();
        initial_condition.acceleration = 0;

        // –†–∞—Å—á–µ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞ –ú–∞—Ö–∞
        AtmosphericModel atmosphere_calc;
        initial_condition.mach_number = atmosphere_calc.calculateMachNumber(
            initial_condition.velocity_total, initial_condition.altitude);

        AircraftState current_state = initial_condition;
        flight_path.addStatePoint(current_state);

        // --------------------------------------------------------------------
        // –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ú–û–î–ï–õ–ò–†–û–í–ê–ù–ò–ò
        // --------------------------------------------------------------------
        std::cout << "\n" << std::string(60, '=') << std::endl;
        std::cout << "–ú–û–î–ï–õ–ò–†–û–í–ê–ù–ò–ï –ü–û–õ–ï–¢–ê –¢–£-134" << std::endl;
        std::cout << std::string(60, '=') << std::endl;

        std::cout << "\n –ü–ê–†–ê–ú–ï–¢–†–´ –ü–û–õ–ï–¢–ê:" << std::endl;
        std::cout << "   –°—Ç–∞—Ä—Ç–æ–≤–∞—è –≤—ã—Å–æ—Ç–∞: " << START_ALTITUDE << " –º" << std::endl;
        std::cout << "   –ö—Ä–µ–π—Å–µ—Ä—Å–∫–∞—è –≤—ã—Å–æ—Ç–∞: " << TARGET_ALTITUDE << " –º" << std::endl;
        std::cout << "   –°—Ç–∞—Ä—Ç–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: " << START_SPEED_KPH << " –∫–º/—á" << std::endl;
        std::cout << "   –ö—Ä–µ–π—Å–µ—Ä—Å–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: " << TARGET_SPEED_KPH << " –∫–º/—á" << std::endl;
        std::cout << "   –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è: " << max_flight_time << " —Å" << std::endl;

        // --------------------------------------------------------------------
        // –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –£–†–ê–í–ù–ï–ù–ò–ô –î–í–ò–ñ–ï–ù–ò–Ø
        // --------------------------------------------------------------------
        int iteration_count = 0;
        bool destination_reached = false;

        std::cout << "\n –í–´–ü–û–õ–ù–ï–ù–ò–ï –†–ê–°–ß–ï–¢–û–í..." << std::endl;

        while (current_state.time_seconds < max_flight_time && !destination_reached) {
            iteration_count++;

            // –ü—Ä–æ—Å—Ç–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–≥–ª–æ–º –∞—Ç–∞–∫–∏
            double altitude_progress = current_state.altitude / TARGET_ALTITUDE;
            double target_aoa;

            if (altitude_progress < 0.3) {
                target_aoa = 0.06;      // –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–π –Ω–∞–±–æ—Ä –≤—ã—Å–æ—Ç—ã
            } else if (altitude_progress < 0.7) {
                target_aoa = 0.04;      // –ü–ª–∞–≤–Ω—ã–π –Ω–∞–±–æ—Ä –≤—ã—Å–æ—Ç—ã
            } else {
                target_aoa = 0.02;      // –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –∫—Ä–µ–π—Å–µ—Ä—Å–∫–æ–π –≤—ã—Å–æ—Ç–µ
            }

            // –ö–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–ª—è –Ω–∞–±–æ—Ä–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏
            if (current_state.velocity_total < TARGET_SPEED_MS * 0.9) {
                target_aoa -= 0.01;
            }

            // –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–π –¥–≤–∏–∂–µ–Ω–∏—è
            current_state = aircraft.predictNextState(current_state, TIME_INCREMENT,target_aoa);
            flight_path.addStatePoint(current_state);

            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            if (iteration_count % 30 == 0) {
                std::cout << "   –®–∞–≥ " << iteration_count
                         << " | –í—Ä–µ–º—è: " << current_state.time_seconds << " —Å"
                         << " | –í—ã—Å–æ—Ç–∞: " << current_state.altitude << " –º"
                         << " (" << (altitude_progress * 100) << "%)" << std::endl;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–π –≤—ã—Å–æ—Ç—ã
            if (current_state.altitude >= TARGET_ALTITUDE) {
                destination_reached = true;
                std::cout << "\n –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê!" << std::endl;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫—É—é –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
            if (current_state.altitude > 20000 || current_state.velocity_total > 1000) {
                std::cout << "\n –í–ù–ò–ú–ê–ù–ò–ï: –í—ã—Ö–æ–¥ –∑–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–µ–ª—ã!" << std::endl;
                break;
            }
        }

        // --------------------------------------------------------------------
        // –†–ï–ó–£–õ–¨–¢–ê–¢–´ –†–ê–°–ß–ï–¢–û–í
        // --------------------------------------------------------------------
        std::cout << "\n" << std::string(60, '=') << std::endl;
        std::cout << " –†–ï–ó–£–õ–¨–¢–ê–¢–´" << std::endl;
        std::cout << std::string(60, '=') << std::endl;

        std::cout << "\n –§–ò–ù–ê–õ–¨–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´:" << std::endl;
        std::cout << "   –í—ã—Å–æ—Ç–∞: " << current_state.altitude << " –º ("
                 << (current_state.altitude / TARGET_ALTITUDE * 100) << "% –æ—Ç —Ü–µ–ª–∏)" << std::endl;
        std::cout << "   –°–∫–æ—Ä–æ—Å—Ç—å: " << std::fixed << std::setprecision(1)
                 << current_state.velocity_total * 3.6 << " –∫–º/—á" << std::endl;
        std::cout << "   –í—Ä–µ–º—è –ø–æ–ª–µ—Ç–∞: " << current_state.time_seconds << " —Å" << std::endl;
        std::cout << "   –†–∞—Å—Ö–æ–¥ —Ç–æ–ø–ª–∏–≤–∞: " << current_state.fuel_consumed << " –∫–≥" << std::endl;
        std::cout << "   –ß–∏—Å–ª–æ –ú–∞—Ö–∞: " << std::fixed << std::setprecision(3)
                 << current_state.mach_number << std::endl;
        std::cout << "   –û—Å—Ç–∞—Ç–æ–∫ –º–∞—Å—Å—ã: " << current_state.current_mass << " –∫–≥" << std::endl;

        std::cout << "\n –°–¢–ê–¢–ò–°–¢–ò–ö–ê:" << std::endl;
        std::cout << "   –°—Ä–µ–¥–Ω—è—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: "
                 << (current_state.altitude - START_ALTITUDE) / current_state.time_seconds
                 << " –º/—Å" << std::endl;
        std::cout << "   –°—Ä–µ–¥–Ω–∏–π —Ä–∞—Å—Ö–æ–¥ —Ç–æ–ø–ª–∏–≤–∞: "
                 << current_state.fuel_consumed / current_state.time_seconds
                 << " –∫–≥/—Å" << std::endl;

        return flight_path;
    }
};

int main() {
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–∫–∞–ª–∏ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã
    setlocale(LC_ALL, "ru_RU.UTF-8");

    try {
        std::cout << "\n" << std::string(60, '=') << std::endl;
        std::cout << " –°–ò–ú–£–õ–Ø–¢–û–† –ü–û–õ–ï–¢–ê –¢–£-134" << std::endl;
        std::cout << "   –í–µ—Ä—Å–∏—è 2.0 | –ê—ç—Ä–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ" << std::endl;
        std::cout << std::string(60, '=') << std::endl;

        // –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ —Å–∞–º–æ–ª–µ—Ç–∞
        Aircraft tu134_model;

        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏
        TrajectoryPlanner flight_planner;

        // –†–∞—Å—á–µ—Ç —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ–ª–µ—Ç–∞
        FlightTrajectory optimal_path = flight_planner.calculateFlightPath(tu134_model, 300.0);

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        optimal_path.exportToCSV("tu134_flight_profile.csv");

        // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        optimal_path.visualize();

        std::cout << "\n–ú–û–î–ï–õ–ò–†–û–í–ê–ù–ò–ï –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù–û!" << std::endl;

    } catch (const std::exception& error) {
        std::cerr << "\n–û–®–ò–ë–ö–ê: " << error.what() << std::endl;
        return EXIT_FAILURE;
    }

    return EXIT_SUCCESS;
}
